{"version":3,"file":"lib.js","sources":["../../src/tools/lib.ts"],"sourcesContent":["import * as path from 'node:path'\nimport * as url from 'node:url'\nimport { parseArgs } from 'node:util'\n\nimport { type IBuildAgent } from '@agents/common'\nimport { type IRunner } from '@tools/common'\n\ntype CliArgs = {\n    agent: string\n    tool: string\n    command: string\n}\n\nexport async function getAgent(buildAgent: string | undefined): Promise<IBuildAgent> {\n    const agent = `./${buildAgent}/agent.js`\n    const module: { BuildAgent: new () => IBuildAgent } = await import(agent)\n    return new module.BuildAgent()\n}\n\nexport async function getToolRunner(buildAgent: string | undefined, tool: string | undefined): Promise<IRunner> {\n    const agent = await getAgent(buildAgent)\n    const toolRunner = `./${tool}.js`\n    const module: { Runner: new (buildAgent: IBuildAgent) => IRunner } = await import(toolRunner)\n    return new module.Runner(agent)\n}\n\nexport function parseCliArgs(): CliArgs {\n    return parseArgs({\n        options: {\n            agent: { type: 'string', short: 'a' },\n            tool: { type: 'string', short: 't' },\n            command: { type: 'string', short: 'c' }\n        }\n    }).values as CliArgs\n}\n\nexport async function run(buildAgent: string, scriptUrl: string | url.URL): Promise<number> {\n    const filename = url.fileURLToPath(scriptUrl)\n    const commandPath = path.dirname(filename)\n    const toolPath = path.dirname(commandPath)\n    const command = path.parse(commandPath).name\n    const toolName = path.parse(toolPath).name\n\n    const runner = await getToolRunner(buildAgent, toolName)\n    return await runner.run(command)\n}\n"],"names":[],"mappings":";;;;AAaA,eAAsB,SAAS,UAAsD,EAAA;AACjF,EAAM,MAAA,KAAA,GAAQ,KAAK,UAAU,CAAA,SAAA,CAAA,CAAA;AAC7B,EAAM,MAAA,MAAA,GAAgD,MAAM,OAAO,KAAA,CAAA,CAAA;AACnE,EAAO,OAAA,IAAI,OAAO,UAAW,EAAA,CAAA;AACjC,CAAA;AAEsB,eAAA,aAAA,CAAc,YAAgC,IAA4C,EAAA;AAC5G,EAAM,MAAA,KAAA,GAAQ,MAAM,QAAA,CAAS,UAAU,CAAA,CAAA;AACvC,EAAM,MAAA,UAAA,GAAa,KAAK,IAAI,CAAA,GAAA,CAAA,CAAA;AAC5B,EAAM,MAAA,MAAA,GAA+D,MAAM,OAAO,UAAA,CAAA,CAAA;AAClF,EAAO,OAAA,IAAI,MAAO,CAAA,MAAA,CAAO,KAAK,CAAA,CAAA;AAClC,CAAA;AAEO,SAAS,YAAwB,GAAA;AACpC,EAAA,OAAO,SAAU,CAAA;AAAA,IACb,OAAS,EAAA;AAAA,MACL,KAAO,EAAA,EAAE,IAAM,EAAA,QAAA,EAAU,OAAO,GAAI,EAAA;AAAA,MACpC,IAAM,EAAA,EAAE,IAAM,EAAA,QAAA,EAAU,OAAO,GAAI,EAAA;AAAA,MACnC,OAAS,EAAA,EAAE,IAAM,EAAA,QAAA,EAAU,OAAO,GAAI,EAAA;AAAA,KAC1C;AAAA,GACH,CAAE,CAAA,MAAA,CAAA;AACP,CAAA;AAEsB,eAAA,GAAA,CAAI,YAAoB,SAA8C,EAAA;AACxF,EAAM,MAAA,QAAA,GAAW,GAAI,CAAA,aAAA,CAAc,SAAS,CAAA,CAAA;AAC5C,EAAM,MAAA,WAAA,GAAc,IAAK,CAAA,OAAA,CAAQ,QAAQ,CAAA,CAAA;AACzC,EAAM,MAAA,QAAA,GAAW,IAAK,CAAA,OAAA,CAAQ,WAAW,CAAA,CAAA;AACzC,EAAA,MAAM,OAAU,GAAA,IAAA,CAAK,KAAM,CAAA,WAAW,CAAE,CAAA,IAAA,CAAA;AACxC,EAAA,MAAM,QAAW,GAAA,IAAA,CAAK,KAAM,CAAA,QAAQ,CAAE,CAAA,IAAA,CAAA;AAEtC,EAAA,MAAM,MAAS,GAAA,MAAM,aAAc,CAAA,UAAA,EAAY,QAAQ,CAAA,CAAA;AACvD,EAAO,OAAA,MAAM,MAAO,CAAA,GAAA,CAAI,OAAO,CAAA,CAAA;AACnC;;;;"}