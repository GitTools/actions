{"version":3,"file":"tools.js","sources":["../../src/agents/common/index.ts","../../src/tools/common/models.ts","../../src/tools/common/dotnet-tool.ts","../../src/tools/common/settings.ts","../../src/tools/common/index.ts"],"sourcesContent":["import { IBuildAgent } from './build-agent'\n\nexport * from './models'\nexport * from './build-agent'\n\nexport async function getAgent(buildAgent: string | undefined): Promise<IBuildAgent> {\n    const agent = `../agents/${buildAgent}/build-agent.js`\n    const module: { BuildAgent: new () => IBuildAgent } = await import(agent)\n    return new module.BuildAgent()\n}\n","export enum SetupFields {\n    includePrerelease = 'includePrerelease',\n    versionSpec = 'versionSpec',\n    ignoreFailedSources = 'ignoreFailedSources',\n    preferLatestVersion = 'preferLatestVersion'\n}\n\nexport type CliArgs = {\n    command: string\n    buildAgent: string\n}\n\nexport type SetupSettings = {\n    [SetupFields.versionSpec]: string\n    [SetupFields.includePrerelease]: boolean\n    [SetupFields.ignoreFailedSources]: boolean\n    [SetupFields.preferLatestVersion]: boolean\n}\n","import * as crypto from 'node:crypto'\nimport * as fs from 'node:fs/promises'\nimport * as os from 'node:os'\nimport * as path from 'node:path'\n\nimport * as semver from 'semver'\nimport { IBuildAgent, type ExecResult } from '@agents/common'\nimport { ISettingsProvider } from './settings'\n\nexport interface IDotnetTool {\n    disableTelemetry(): void\n\n    install(): Promise<string>\n}\n\ntype NugetVersions = { data: { versions: { version: string }[] }[] }\n\nexport abstract class DotnetTool implements IDotnetTool {\n    private static readonly nugetRoot: string = 'https://azuresearch-usnc.nuget.org/query'\n\n    constructor(protected buildAgent: IBuildAgent) {}\n\n    abstract get packageName(): string\n\n    abstract get toolName(): string\n\n    abstract get toolPathVariable(): string\n\n    abstract get versionRange(): string | null\n\n    abstract get settingsProvider(): ISettingsProvider\n\n    disableTelemetry(): void {\n        this.buildAgent.info('Disable Telemetry')\n        this.buildAgent.setVariable('DOTNET_CLI_TELEMETRY_OPTOUT', 'true')\n        this.buildAgent.setVariable('DOTNET_NOLOGO', 'true')\n    }\n\n    async install(): Promise<string> {\n        const dotnetExePath = await this.buildAgent.which('dotnet', true)\n        this.buildAgent.debug(`whichPath: ${dotnetExePath}`)\n        await this.setDotnetRoot()\n\n        const setupSettings = this.settingsProvider.getSetupSettings()\n\n        let version: string | null = semver.clean(setupSettings.versionSpec) || setupSettings.versionSpec\n        this.buildAgent.info('--------------------------')\n        this.buildAgent.info(`Acquiring ${this.packageName} for version spec: ${version}`)\n        this.buildAgent.info('--------------------------')\n\n        if (!this.isExplicitVersion(version)) {\n            version = await this.queryLatestMatch(this.packageName, version, setupSettings.includePrerelease)\n            if (!version) {\n                throw new Error(`Unable to find ${this.packageName} version '${version}'.`)\n            }\n        }\n\n        if (this.versionRange && !semver.satisfies(version, this.versionRange, { includePrerelease: setupSettings.includePrerelease })) {\n            throw new Error(\n                `Version spec '${setupSettings.versionSpec}' resolved as '${version}' does not satisfy the range '${this.versionRange}'.` +\n                    'See https://github.com/GitTools/actions/blob/main/docs/versions.md for more information.'\n            )\n        }\n\n        let toolPath: string | null = null\n        if (!setupSettings.preferLatestVersion) {\n            // Let's try and resolve the version locally first\n            toolPath = await this.buildAgent.findLocalTool(this.packageName, version)\n            if (toolPath) {\n                this.buildAgent.info('--------------------------')\n                this.buildAgent.info(`${this.packageName} version: ${version} found in local cache at ${toolPath}.`)\n                this.buildAgent.info('--------------------------')\n            }\n        }\n\n        if (!toolPath) {\n            // Download, extract, cache\n            toolPath = await this.installTool(this.packageName, version, setupSettings.ignoreFailedSources)\n            this.buildAgent.info('--------------------------')\n            this.buildAgent.info(`${this.packageName} version: ${version} installed.`)\n            this.buildAgent.info('--------------------------')\n        }\n\n        // Prepend the tool's path. This prepends the PATH for the current process and\n        // instructs the agent to prepend for each task that follows.\n        this.buildAgent.info(`Prepending ${toolPath} to PATH`)\n        this.buildAgent.addPath(toolPath)\n\n        return toolPath\n    }\n\n    protected async execute(cmd: string, args: string[]): Promise<ExecResult> {\n        this.buildAgent.info(`Command: ${cmd} ${args.join(' ')}`)\n        return await this.buildAgent.exec(cmd, args)\n    }\n\n    protected async setDotnetRoot(): Promise<void> {\n        if (os.platform() !== 'win32' && !this.buildAgent.getVariable('DOTNET_ROOT')) {\n            let dotnetPath = await this.buildAgent.which('dotnet', true)\n\n            const stats = await fs.lstat(dotnetPath)\n            if (stats.isSymbolicLink()) {\n                dotnetPath = (await fs.readlink(dotnetPath)) || dotnetPath\n            }\n            const dotnetRoot = path.dirname(dotnetPath)\n            this.buildAgent.setVariable('DOTNET_ROOT', dotnetRoot)\n        }\n    }\n\n    protected async executeTool(args: string[]): Promise<ExecResult> {\n        let toolPath: string | undefined\n        const gitVersionPath = this.buildAgent.getVariableAsPath(this.toolPathVariable)\n        if (gitVersionPath) {\n            toolPath = path.join(gitVersionPath, os.platform() === 'win32' ? `${this.toolName}.exe` : this.toolName)\n        }\n        if (!toolPath) {\n            toolPath = await this.buildAgent.which(this.toolName, true)\n        }\n        return await this.execute(toolPath, args)\n    }\n\n    protected async isValidInputFile(input: string, file: string): Promise<boolean> {\n        return this.filePathSupplied(input) && (await this.buildAgent.fileExists(file))\n    }\n\n    protected filePathSupplied(file: string): boolean {\n        const pathValue = path.resolve(this.buildAgent.getInput(file) || '')\n        const repoRoot = this.buildAgent.sourceDir\n        return pathValue !== repoRoot\n    }\n\n    protected async getRepoPath(targetPath: string): Promise<string> {\n        const srcDir = this.buildAgent.sourceDir || '.'\n        let workDir: string\n        if (!targetPath) {\n            workDir = srcDir\n        } else {\n            if (await this.buildAgent.directoryExists(targetPath)) {\n                workDir = targetPath\n            } else {\n                throw new Error(`Directory not found at ${targetPath}`)\n            }\n        }\n        return workDir.replace(/\\\\/g, '/')\n    }\n\n    private async queryLatestMatch(toolName: string, versionSpec: string, includePrerelease: boolean): Promise<string | null> {\n        this.buildAgent.info(\n            `Querying tool versions for ${toolName}${versionSpec ? `@${versionSpec}` : ''} ${includePrerelease ? 'including pre-releases' : ''}`\n        )\n\n        const toolNameParam = encodeURIComponent(toolName.toLowerCase())\n        const prereleaseParam = includePrerelease ? 'true' : 'false'\n        const downloadPath = `${DotnetTool.nugetRoot}?q=${toolNameParam}&prerelease=${prereleaseParam}&semVerLevel=2.0.0&take=1`\n\n        const response = await fetch(downloadPath)\n\n        if (!response || !response.ok) {\n            this.buildAgent.info(`failed to query latest version for ${toolName} from ${downloadPath}. Status code: ${response ? response.status : 'unknown'}`)\n            return null\n        }\n\n        const { data } = (await response.json()) as NugetVersions\n\n        const versions = data[0].versions.map(x => x.version)\n        if (!versions || !versions.length) {\n            return null\n        }\n\n        this.buildAgent.debug(`got versions: ${versions.join(', ')}`)\n\n        const version = semver.maxSatisfying(versions, versionSpec, { includePrerelease })\n        if (version) {\n            this.buildAgent.info(`Found matching version: ${version}`)\n        } else {\n            this.buildAgent.info('match not found')\n        }\n\n        return version\n    }\n\n    private async installTool(toolName: string, version: string, ignoreFailedSources: boolean): Promise<string> {\n        const semverVersion = semver.clean(version)\n        if (!semverVersion) {\n            throw new Error(`Invalid version spec: ${version}`)\n        }\n\n        const tempDirectory = await this.createTempDirectory()\n\n        if (!tempDirectory) {\n            throw new Error('Unable to create temp directory')\n        }\n\n        const args = ['tool', 'install', toolName, '--tool-path', tempDirectory, '--version', semverVersion]\n        if (ignoreFailedSources) {\n            args.push('--ignore-failed-sources')\n        }\n\n        const result = await this.execute('dotnet', args)\n        const status = result.code === 0 ? 'success' : 'failure'\n        const message = result.code === 0 ? result.stdout : result.stderr\n\n        this.buildAgent.debug(`Tool install result: ${status} ${message}`)\n\n        if (result.code !== 0) {\n            throw new Error(message)\n        }\n\n        const toolPath = await this.buildAgent.cacheToolDirectory(tempDirectory, toolName, semverVersion)\n        this.buildAgent.debug(`Cached tool path: ${toolPath}`)\n        this.buildAgent.debug(`Cleaning up temp directory: ${tempDirectory}`)\n        await this.buildAgent.removeDirectory(tempDirectory)\n\n        return toolPath\n    }\n\n    async createTempDirectory(): Promise<string> {\n        const tempRootDir = this.buildAgent.tempDir\n        if (!tempRootDir) {\n            throw new Error('Temp directory not set')\n        }\n\n        const uuid = crypto.randomUUID()\n        const tempPath = path.join(tempRootDir, uuid)\n        this.buildAgent.debug(`Creating temp directory ${tempPath}`)\n        await fs.mkdir(tempPath, { recursive: true })\n        return tempPath\n    }\n\n    private isExplicitVersion(versionSpec: string): boolean {\n        const cleanedVersionSpec = semver.clean(versionSpec)\n        const valid = semver.valid(cleanedVersionSpec) != null\n        this.buildAgent.debug(`Is version explicit? ${valid}`)\n\n        return valid\n    }\n}\n","import { IBuildAgent } from '@agents/common'\nimport { type SetupSettings, SetupFields } from './models'\n\nexport interface ISettingsProvider {\n    getSetupSettings(): SetupSettings\n}\n\nexport class SettingsProvider implements ISettingsProvider {\n    constructor(protected buildAgent: IBuildAgent) {}\n\n    getSetupSettings(): SetupSettings {\n        const versionSpec = this.buildAgent.getInput(SetupFields.versionSpec)\n        const includePrerelease = this.buildAgent.getBooleanInput(SetupFields.includePrerelease)\n        const ignoreFailedSources = this.buildAgent.getBooleanInput(SetupFields.ignoreFailedSources)\n        const preferLatestVersion = this.buildAgent.getBooleanInput(SetupFields.preferLatestVersion)\n\n        return {\n            versionSpec,\n            includePrerelease,\n            ignoreFailedSources,\n            preferLatestVersion\n        }\n    }\n}\n","import { parseArgs } from 'node:util'\nimport { type CliArgs } from './models'\n\nexport * from './models'\nexport * from './dotnet-tool'\nexport * from './settings'\n\nexport function parseCliArgs(): CliArgs {\n    return parseArgs({\n        options: {\n            command: { type: 'string', short: 'c' },\n            buildAgent: { type: 'string', short: 'a' }\n        }\n    }).values as CliArgs\n}\n\nexport const keysFn = Object.keys as <T extends object>(obj: T) => (keyof T)[]\n"],"names":["SetupFields","semver.clean","semver.satisfies","semver.maxSatisfying","semver.valid"],"mappings":"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"}