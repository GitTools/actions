{"version":3,"file":"gitversion.mjs","sources":["../../../src/tools/gitversion/settings.ts","../../../src/tools/gitversion/tool.ts","../../../src/tools/gitversion/runner.ts"],"sourcesContent":["import { type ISettingsProvider, SettingsProvider } from '@tools/common'\nimport { type CommandSettings, type ExecuteSettings } from './models'\n\nexport interface IGitVersionSettingsProvider extends ISettingsProvider {\n    getExecuteSettings(): ExecuteSettings\n\n    getCommandSettings(): CommandSettings\n}\n\nexport class GitVersionSettingsProvider extends SettingsProvider implements IGitVersionSettingsProvider {\n    getExecuteSettings(): ExecuteSettings {\n        const targetPath = this.buildAgent.getInput<ExecuteSettings>('targetPath')\n\n        const disableCache = this.buildAgent.getBooleanInput<ExecuteSettings>('disableCache')\n        const disableNormalization = this.buildAgent.getBooleanInput<ExecuteSettings>('disableNormalization')\n        const disableShallowCloneCheck = this.buildAgent.getBooleanInput<ExecuteSettings>('disableShallowCloneCheck')\n\n        const useConfigFile = this.buildAgent.getBooleanInput<ExecuteSettings>('useConfigFile')\n        const configFilePath = this.buildAgent.getInput<ExecuteSettings>('configFilePath')\n        const overrideConfig = this.buildAgent.getListInput<ExecuteSettings>('overrideConfig')\n\n        const updateAssemblyInfo = this.buildAgent.getBooleanInput<ExecuteSettings>('updateAssemblyInfo')\n        const updateAssemblyInfoFilename = this.buildAgent.getInput<ExecuteSettings>('updateAssemblyInfoFilename')\n\n        return {\n            targetPath,\n            disableCache,\n            disableNormalization,\n            disableShallowCloneCheck,\n            useConfigFile,\n            configFilePath,\n            overrideConfig,\n            updateAssemblyInfo,\n            updateAssemblyInfoFilename\n        }\n    }\n\n    getCommandSettings(): CommandSettings {\n        const targetPath = this.buildAgent.getInput<CommandSettings>('targetPath')\n        const disableShallowCloneCheck = this.buildAgent.getBooleanInput<CommandSettings>('disableShallowCloneCheck')\n        const args = this.buildAgent.getInput<CommandSettings>('arguments')\n\n        return {\n            targetPath,\n            disableShallowCloneCheck,\n            arguments: args\n        }\n    }\n}\n","import { type ExecResult } from '@agents/common'\nimport { DotnetTool, keysOf } from '@tools/common'\nimport { type CommandSettings, type ExecuteSettings, type GitVersionOutput } from './models'\nimport { GitVersionSettingsProvider, type IGitVersionSettingsProvider } from './settings'\n\nexport class GitVersionTool extends DotnetTool {\n    get packageName(): string {\n        return 'GitVersion.Tool'\n    }\n\n    get toolName(): string {\n        return 'dotnet-gitversion'\n    }\n\n    get toolPathVariable(): string {\n        return 'GITVERSION_PATH'\n    }\n\n    get versionRange(): string | null {\n        return '>=5.2.0 <6.1.0'\n    }\n\n    get settingsProvider(): IGitVersionSettingsProvider {\n        return new GitVersionSettingsProvider(this.buildAgent)\n    }\n\n    async executeJson(): Promise<ExecResult> {\n        const settings = this.settingsProvider.getExecuteSettings()\n        const workDir = await this.getRepoDir(settings)\n\n        await this.checkShallowClone(settings, workDir)\n\n        const args = await this.getExecuteArguments(workDir, settings)\n\n        await this.setDotnetRoot()\n        return await this.executeTool(args)\n    }\n\n    async executeCommand(): Promise<ExecResult> {\n        const settings = this.settingsProvider.getCommandSettings()\n        const workDir = await this.getRepoDir(settings)\n\n        await this.checkShallowClone(settings, workDir)\n\n        const args = this.getCommandArguments(workDir, settings)\n\n        await this.setDotnetRoot()\n        return await this.executeTool(args)\n    }\n\n    writeGitVersionToAgent(output: GitVersionOutput): void {\n        for (const property of keysOf(output)) {\n            const name = this.toCamelCase(property)\n            try {\n                let value = output[property]?.toString()\n                if (value === '0') {\n                    value = '0'\n                }\n                this.buildAgent.setOutput(name, value)\n                this.buildAgent.setOutput(`GitVersion_${property}`, value)\n                this.buildAgent.setVariable(name, value)\n                this.buildAgent.setVariable(`GitVersion_${property}`, value)\n            } catch (_error) {\n                this.buildAgent.error(`Unable to set output/variable for ${property}`)\n            }\n        }\n    }\n\n    protected async getRepoDir(settings: ExecuteSettings | CommandSettings): Promise<string> {\n        return await super.getRepoPath(settings.targetPath)\n    }\n\n    protected async getExecuteArguments(workDir: string, options: ExecuteSettings): Promise<string[]> {\n        const args = [workDir, '/output', 'json', '/output', 'buildserver']\n\n        const {\n            useConfigFile,\n            disableCache,\n            disableNormalization,\n            configFilePath,\n            overrideConfig,\n            updateAssemblyInfo,\n            updateAssemblyInfoFilename\n            //\n        } = options\n\n        if (disableCache) {\n            args.push('/nocache')\n        }\n\n        if (disableNormalization) {\n            args.push('/nonormalize')\n        }\n\n        if (useConfigFile) {\n            if (await this.isValidInputFile('configFilePath', configFilePath)) {\n                args.push('/config', configFilePath)\n            } else {\n                throw new Error(`GitVersion configuration file not found at ${configFilePath}`)\n            }\n        }\n\n        if (overrideConfig) {\n            for (let config of overrideConfig) {\n                config = config.trim()\n                if (config.match(/([a-zA-Z0-9]+(-[a-zA-Z]+)*=[a-zA-Z0-9\\- :.']*)/)) {\n                    args.push('/overrideconfig', config)\n                }\n            }\n        }\n\n        if (updateAssemblyInfo) {\n            args.push('/updateassemblyinfo')\n\n            // You can specify 'updateAssemblyInfo' without 'updateAssemblyInfoFilename'.\n            if (updateAssemblyInfoFilename?.length > 0) {\n                if (await this.isValidInputFile('updateAssemblyInfoFilename', updateAssemblyInfoFilename)) {\n                    args.push(updateAssemblyInfoFilename)\n                } else {\n                    throw new Error(`AssemblyInfoFilename file not found at ${updateAssemblyInfoFilename}`)\n                }\n            }\n        }\n\n        return args\n    }\n\n    protected getCommandArguments(workDir: string, options: CommandSettings): string[] {\n        let args = [workDir]\n\n        if (options.arguments) {\n            args = args.concat(this.argStringToArray(options.arguments))\n        }\n        return args\n    }\n\n    private argStringToArray(argString: string): string[] {\n        const args: string[] = []\n\n        let inQuotes = false\n        let escaped = false\n        let lastCharWasSpace = true\n        let arg = ''\n\n        const append = (c: string): void => {\n            // we only escape double quotes.\n            if (escaped && c !== '\"') {\n                arg += '\\\\'\n            }\n\n            arg += c\n            escaped = false\n        }\n\n        for (let i = 0; i < argString.length; i++) {\n            const c = argString.charAt(i)\n\n            if (c === ' ' && !inQuotes) {\n                if (!lastCharWasSpace) {\n                    args.push(arg)\n                    arg = ''\n                }\n                lastCharWasSpace = true\n                continue\n            } else {\n                lastCharWasSpace = false\n            }\n\n            if (c === '\"') {\n                if (!escaped) {\n                    inQuotes = !inQuotes\n                } else {\n                    append(c)\n                }\n                continue\n            }\n\n            if (c === '\\\\' && escaped) {\n                append(c)\n                continue\n            }\n\n            if (c === '\\\\' && inQuotes) {\n                escaped = true\n                continue\n            }\n\n            append(c)\n            lastCharWasSpace = false\n        }\n\n        if (!lastCharWasSpace) {\n            args.push(arg.trim())\n        }\n\n        return args\n    }\n\n    private async checkShallowClone(settings: ExecuteSettings | CommandSettings, workDir: string): Promise<void> {\n        if (!settings.disableShallowCloneCheck) {\n            const isShallowResult = await this.execute('git', ['-C', workDir, 'rev-parse', '--is-shallow-repository'])\n            if (isShallowResult.code === 0 && isShallowResult.stdout?.trim() === 'true') {\n                throw new Error(\n                    'The repository is shallow. Consider disabling shallow clones. See https://github.com/GitTools/actions/blob/main/docs/cloning.md for more information.'\n                )\n            }\n        }\n    }\n\n    private toCamelCase(input: string): string {\n        return input.replace(/^\\w|[A-Z]|\\b\\w|\\s+/g, function (match, index) {\n            if (+match === 0) return '' // or if (/\\s+/.test(match)) for white spaces\n            return index === 0 ? match.toLowerCase() : match.toUpperCase()\n        })\n    }\n}\n","import { type ExecResult, type IBuildAgent } from '@agents/common'\nimport { type IRunner } from '@tools/common'\nimport { type Commands, type GitVersionOutput } from './models'\nimport { GitVersionTool } from './tool'\n\nexport class Runner implements IRunner {\n    private readonly gitVersionTool: GitVersionTool\n\n    constructor(private readonly buildAgent: IBuildAgent) {\n        this.gitVersionTool = new GitVersionTool(this.buildAgent)\n    }\n\n    async run(command: Commands): Promise<ExecResult> {\n        switch (command) {\n            case 'setup':\n                return await this.setup()\n            case 'execute':\n                return await this.execute()\n            case 'command':\n                return await this.command()\n        }\n    }\n\n    private async setup(): Promise<ExecResult> {\n        try {\n            this.disableTelemetry()\n\n            this.buildAgent.debug('Installing GitVersion')\n            const toolPath = await this.gitVersionTool.install()\n\n            const pathVariable = this.gitVersionTool.toolPathVariable\n            this.buildAgent.info(`Set ${pathVariable} to ${toolPath}`)\n            this.buildAgent.setVariable(pathVariable, toolPath)\n\n            this.buildAgent.setSucceeded('GitVersion installed successfully', true)\n            return {\n                code: 0\n            }\n        } catch (error) {\n            if (error instanceof Error) {\n                this.buildAgent.setFailed(error.message, true)\n            }\n            return {\n                code: -1,\n                error: error as Error\n            }\n        }\n    }\n\n    private async execute(): Promise<ExecResult> {\n        try {\n            this.disableTelemetry()\n\n            this.buildAgent.info('Executing GitVersion')\n\n            const result = await this.gitVersionTool.executeJson()\n\n            if (result.code === 0) {\n                this.buildAgent.info('GitVersion executed successfully')\n                const stdout: string = result.stdout as string\n\n                this.buildAgent.info('GitVersion output:')\n                this.buildAgent.info('-------------------')\n                this.buildAgent.info(stdout)\n                this.buildAgent.info('-------------------')\n                this.buildAgent.debug('Parsing GitVersion output')\n\n                if (stdout.lastIndexOf('{') === -1 || stdout.lastIndexOf('}') === -1) {\n                    this.buildAgent.debug('GitVersion output is not valid JSON')\n                    this.buildAgent.setFailed('GitVersion output is not valid JSON', true)\n                    return {\n                        code: -1,\n                        error: new Error('GitVersion output is not valid JSON')\n                    }\n                } else {\n                    const jsonOutput = stdout.substring(stdout.lastIndexOf('{'), stdout.lastIndexOf('}') + 1)\n\n                    const gitVersionOutput = JSON.parse(jsonOutput) as GitVersionOutput\n                    this.gitVersionTool.writeGitVersionToAgent(gitVersionOutput)\n                    this.buildAgent.setSucceeded('GitVersion executed successfully', true)\n                    return result\n                }\n            } else {\n                this.buildAgent.debug('GitVersion failed')\n                const error = result.error\n                if (error instanceof Error) {\n                    this.buildAgent.setFailed(error.message, true)\n                }\n                return result\n            }\n        } catch (error) {\n            if (error instanceof Error) {\n                this.buildAgent.setFailed(error.message, true)\n            }\n            return {\n                code: -1,\n                error: error as Error\n            }\n        }\n    }\n\n    private async command(): Promise<ExecResult> {\n        try {\n            this.disableTelemetry()\n\n            this.buildAgent.info('Executing GitVersion')\n\n            const result = await this.gitVersionTool.executeCommand()\n\n            if (result.code === 0) {\n                this.buildAgent.info('GitVersion executed successfully')\n                const stdout = result.stdout as string\n\n                this.buildAgent.info('GitVersion output:')\n                this.buildAgent.info('-------------------')\n                this.buildAgent.info(stdout)\n                this.buildAgent.info('-------------------')\n\n                this.buildAgent.setSucceeded('GitVersion executed successfully', true)\n                return result\n            } else {\n                this.buildAgent.debug('GitVersion failed')\n                const error = result.error\n                if (error instanceof Error) {\n                    this.buildAgent.setFailed(error.message, true)\n                }\n                return result\n            }\n        } catch (error) {\n            if (error instanceof Error) {\n                this.buildAgent.setFailed(error.message, true)\n            }\n            return {\n                code: -1,\n                error: error as Error\n            }\n        }\n    }\n\n    private disableTelemetry(): void {\n        this.buildAgent.info(`Running on: '${this.buildAgent.agentName}'`)\n        this.buildAgent.debug('Disabling telemetry')\n        this.gitVersionTool.disableTelemetry()\n    }\n}\n"],"names":[],"mappings":"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"}