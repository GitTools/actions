{"version":3,"file":"tools.mjs","sources":["../../../src/tools/common/dotnet-tool.ts","../../../src/tools/common/settings.ts","../../../src/tools/common/index.ts","../../../src/tools/common/runner.ts"],"sourcesContent":["import * as crypto from 'node:crypto'\nimport * as fs from 'node:fs/promises'\nimport * as os from 'node:os'\nimport * as path from 'node:path'\n\nimport * as semver from 'semver'\nimport { type IBuildAgent, type ExecResult } from '@agents/common'\nimport { ISettingsProvider } from './settings'\nimport { NugetVersions } from './models'\n\nexport interface IDotnetTool {\n    toolName: string\n\n    disableTelemetry(): void\n\n    install(): Promise<string>\n}\n\nexport abstract class DotnetTool implements IDotnetTool {\n    private static readonly nugetRoot: string = 'https://azuresearch-usnc.nuget.org/query'\n\n    constructor(protected buildAgent: IBuildAgent) {}\n\n    abstract get packageName(): string\n\n    abstract get toolName(): string\n\n    abstract get toolPathVariable(): string\n\n    abstract get versionRange(): string | null\n\n    abstract get settingsProvider(): ISettingsProvider\n\n    disableTelemetry(): void {\n        this.buildAgent.info('Disable Telemetry')\n        this.buildAgent.setVariable('DOTNET_CLI_TELEMETRY_OPTOUT', 'true')\n        this.buildAgent.setVariable('DOTNET_NOLOGO', 'true')\n    }\n\n    async install(): Promise<string> {\n        const dotnetExePath = await this.buildAgent.which('dotnet', true)\n        this.buildAgent.debug(`whichPath: ${dotnetExePath}`)\n        await this.setDotnetRoot()\n\n        const setupSettings = this.settingsProvider.getSetupSettings()\n\n        let version: string | null = semver.clean(setupSettings.versionSpec) || setupSettings.versionSpec\n        this.buildAgent.info('--------------------------')\n        this.buildAgent.info(`Acquiring ${this.packageName} for version spec: ${version}`)\n        this.buildAgent.info('--------------------------')\n\n        if (!this.isExplicitVersion(version)) {\n            version = await this.queryLatestMatch(this.packageName, version, setupSettings.includePrerelease)\n            if (!version) {\n                throw new Error(`Unable to find ${this.packageName} version '${version}'.`)\n            }\n        }\n\n        if (this.versionRange && !semver.satisfies(version, this.versionRange, { includePrerelease: setupSettings.includePrerelease })) {\n            throw new Error(\n                `Version spec '${setupSettings.versionSpec}' resolved as '${version}' does not satisfy the range '${this.versionRange}'.` +\n                    'See https://github.com/GitTools/actions/blob/main/docs/versions.md for more information.'\n            )\n        }\n\n        let toolPath: string | null = null\n        if (!setupSettings.preferLatestVersion) {\n            // Let's try and resolve the version locally first\n            toolPath = await this.buildAgent.findLocalTool(this.packageName, version)\n            if (toolPath) {\n                this.buildAgent.info('--------------------------')\n                this.buildAgent.info(`${this.packageName} version: ${version} found in local cache at ${toolPath}.`)\n                this.buildAgent.info('--------------------------')\n            }\n        }\n\n        if (!toolPath) {\n            // Download, extract, cache\n            toolPath = await this.installTool(this.packageName, version, setupSettings.ignoreFailedSources)\n            this.buildAgent.info('--------------------------')\n            this.buildAgent.info(`${this.packageName} version: ${version} installed.`)\n            this.buildAgent.info('--------------------------')\n        }\n\n        // Prepend the tool's path. This prepends the PATH for the current process and\n        // instructs the agent to prepend for each task that follows.\n        this.buildAgent.info(`Prepending ${toolPath} to PATH`)\n        this.buildAgent.addPath(toolPath)\n\n        const pathVariable = this.toolPathVariable\n        this.buildAgent.info(`Set ${pathVariable} to ${toolPath}`)\n        this.buildAgent.setVariable(pathVariable, toolPath)\n        this.buildAgent.setSucceeded(`${this.toolName} installed successfully`, true)\n\n        return toolPath\n    }\n\n    protected async execute(cmd: string, args: string[]): Promise<ExecResult> {\n        this.buildAgent.info(`Command: ${cmd} ${args.join(' ')}`)\n        return await this.buildAgent.exec(cmd, args)\n    }\n\n    protected async setDotnetRoot(): Promise<void> {\n        if (os.platform() !== 'win32' && !this.buildAgent.getVariable('DOTNET_ROOT')) {\n            let dotnetPath = await this.buildAgent.which('dotnet', true)\n\n            const stats = await fs.lstat(dotnetPath)\n            if (stats.isSymbolicLink()) {\n                dotnetPath = (await fs.readlink(dotnetPath)) || dotnetPath\n            }\n            const dotnetRoot = path.dirname(dotnetPath)\n            this.buildAgent.setVariable('DOTNET_ROOT', dotnetRoot)\n        }\n    }\n\n    protected async executeTool(args: string[]): Promise<ExecResult> {\n        let toolPath: string | undefined\n        const variableAsPath = this.buildAgent.getVariableAsPath(this.toolPathVariable)\n        if (variableAsPath) {\n            toolPath = path.join(variableAsPath, os.platform() === 'win32' ? `${this.toolName}.exe` : this.toolName)\n        }\n        if (!toolPath) {\n            toolPath = await this.buildAgent.which(this.toolName, true)\n        }\n\n        args = ['--roll-forward Major', ...args]\n        return await this.execute(toolPath, args)\n    }\n\n    protected async isValidInputFile(input: string, file: string): Promise<boolean> {\n        return this.filePathSupplied(input) && (await this.buildAgent.fileExists(file))\n    }\n\n    protected filePathSupplied(file: string): boolean {\n        const pathValue = path.resolve(this.buildAgent.getInput(file) || '')\n        const repoRoot = this.buildAgent.sourceDir\n        return pathValue !== repoRoot\n    }\n\n    protected async getRepoPath(targetPath: string): Promise<string> {\n        const srcDir = this.buildAgent.sourceDir || '.'\n        let workDir: string\n        if (!targetPath) {\n            workDir = srcDir\n        } else {\n            if (await this.buildAgent.directoryExists(targetPath)) {\n                workDir = targetPath\n            } else {\n                throw new Error(`Directory not found at ${targetPath}`)\n            }\n        }\n        return workDir.replace(/\\\\/g, '/')\n    }\n\n    private async queryLatestMatch(toolName: string, versionSpec: string, includePrerelease: boolean): Promise<string | null> {\n        this.buildAgent.info(\n            `Querying tool versions for ${toolName}${versionSpec ? `@${versionSpec}` : ''} ${includePrerelease ? 'including pre-releases' : ''}`\n        )\n\n        const toolNameParam = encodeURIComponent(toolName.toLowerCase())\n        const prereleaseParam = includePrerelease ? 'true' : 'false'\n        const downloadPath = `${DotnetTool.nugetRoot}?q=${toolNameParam}&prerelease=${prereleaseParam}&semVerLevel=2.0.0&take=1`\n\n        const response = await fetch(downloadPath)\n\n        if (!response || !response.ok) {\n            this.buildAgent.info(`failed to query latest version for ${toolName} from ${downloadPath}. Status code: ${response ? response.status : 'unknown'}`)\n            return null\n        }\n\n        const { data } = (await response.json()) as NugetVersions\n\n        const versions = data[0].versions.map(x => x.version)\n        if (!versions || !versions.length) {\n            return null\n        }\n\n        this.buildAgent.debug(`got versions: ${versions.join(', ')}`)\n\n        const version = semver.maxSatisfying(versions, versionSpec, { includePrerelease })\n        if (version) {\n            this.buildAgent.info(`Found matching version: ${version}`)\n        } else {\n            this.buildAgent.info('match not found')\n        }\n\n        return version\n    }\n\n    private async installTool(toolName: string, version: string, ignoreFailedSources: boolean): Promise<string> {\n        const semverVersion = semver.clean(version)\n        if (!semverVersion) {\n            throw new Error(`Invalid version spec: ${version}`)\n        }\n\n        const tempDirectory = await this.createTempDirectory()\n\n        if (!tempDirectory) {\n            throw new Error('Unable to create temp directory')\n        }\n\n        const args = ['tool', 'install', toolName, '--tool-path', tempDirectory, '--version', semverVersion]\n        if (ignoreFailedSources) {\n            args.push('--ignore-failed-sources')\n        }\n\n        const result = await this.execute('dotnet', args)\n        const status = result.code === 0 ? 'success' : 'failure'\n        const message = result.code === 0 ? result.stdout : result.stderr\n\n        this.buildAgent.debug(`Tool install result: ${status} ${message}`)\n\n        if (result.code !== 0) {\n            throw new Error(message)\n        }\n\n        const toolPath = await this.buildAgent.cacheToolDirectory(tempDirectory, toolName, semverVersion)\n        this.buildAgent.debug(`Cached tool path: ${toolPath}`)\n        this.buildAgent.debug(`Cleaning up temp directory: ${tempDirectory}`)\n        await this.buildAgent.removeDirectory(tempDirectory)\n\n        return toolPath\n    }\n\n    async createTempDirectory(): Promise<string> {\n        const tempRootDir = this.buildAgent.tempDir\n        if (!tempRootDir) {\n            throw new Error('Temp directory not set')\n        }\n\n        const uuid = crypto.randomUUID()\n        const tempPath = path.join(tempRootDir, uuid)\n        this.buildAgent.debug(`Creating temp directory ${tempPath}`)\n        await fs.mkdir(tempPath, { recursive: true })\n        return tempPath\n    }\n\n    private isExplicitVersion(versionSpec: string): boolean {\n        const cleanedVersionSpec = semver.clean(versionSpec)\n        const valid = semver.valid(cleanedVersionSpec) != null\n        this.buildAgent.debug(`Is version explicit? ${valid}`)\n\n        return valid\n    }\n}\n","import { type IBuildAgent } from '@agents/common'\nimport { type SetupSettings } from './models'\n\nexport interface ISettingsProvider {\n    getSetupSettings(): SetupSettings\n}\n\nexport class SettingsProvider implements ISettingsProvider {\n    constructor(protected buildAgent: IBuildAgent) {}\n\n    getSetupSettings(): SetupSettings {\n        const versionSpec = this.buildAgent.getInput<SetupSettings>('versionSpec')\n        const includePrerelease = this.buildAgent.getBooleanInput<SetupSettings>('includePrerelease')\n        const ignoreFailedSources = this.buildAgent.getBooleanInput<SetupSettings>('ignoreFailedSources')\n        const preferLatestVersion = this.buildAgent.getBooleanInput<SetupSettings>('preferLatestVersion')\n\n        return {\n            versionSpec,\n            includePrerelease,\n            ignoreFailedSources,\n            preferLatestVersion\n        }\n    }\n}\n","export * from './models'\nexport * from './dotnet-tool'\nexport * from './settings'\n\nexport const keysOf = Object.keys as <T extends object>(obj: T) => (keyof T)[]\n","import type { IRunner } from './models.ts'\nimport { ExecResult, IBuildAgent } from '@agents/common'\nimport { IDotnetTool } from './dotnet-tool.ts'\n\nexport abstract class RunnerBase implements IRunner {\n    protected abstract tool: IDotnetTool\n\n    abstract run(command: string): Promise<ExecResult>\n\n    protected constructor(protected readonly buildAgent: IBuildAgent) {}\n\n    protected disableTelemetry(): void {\n        this.buildAgent.info(`Running on: '${this.buildAgent.agentName}'`)\n        this.buildAgent.debug('Disabling telemetry')\n        this.tool.disableTelemetry()\n    }\n\n    protected async safeExecute(action: () => Promise<ExecResult>, successMessage: string): Promise<ExecResult> {\n        try {\n            this.disableTelemetry()\n            const result = await action()\n\n            this.buildAgent.info(`${this.tool.toolName} Output:`)\n            this.buildAgent.info('-------------------')\n            this.buildAgent.info(result.stdout as string)\n            this.buildAgent.info('-------------------')\n            if (result.code === 0) {\n                this.buildAgent.debug(`${this.tool.toolName} succeeded`)\n                this.buildAgent.setSucceeded(successMessage, true)\n                return result\n            } else {\n                this.buildAgent.debug(`${this.tool.toolName} failed`)\n                this.buildAgent.error(result.stderr as string)\n                this.buildAgent.setFailed(result.stderr as string, true)\n                return result\n            }\n        } catch (error) {\n            if (error instanceof Error) {\n                this.buildAgent.debug(`${this.tool.toolName} failed`)\n                this.buildAgent.error(error.message)\n                this.buildAgent.setFailed(error.message, true)\n            }\n            return {\n                code: -1,\n                error: error as Error\n            }\n        }\n    }\n}\n"],"names":["semver.clean","semver.satisfies","semver.maxSatisfying","semver.valid"],"mappings":"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"}